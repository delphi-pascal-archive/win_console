VirEx (с) 14.11.2005

WinConsul - консоль для удобного ввода команд
Возможности:
* удобный ввод команд/программ в консоли, вызываемой по ctrl+F12
  в WinConsul запускаеться всё, что можно запустить из меню "пуск-выполнить", к примеру:
  calc, cmd, http://www.site.ru, ipconfig /all и т.п.
* автоввод - ввод команд по первым символам уже ранее введенных команд
* работа в режиме интерпретатора команд Windows - CMD (по ctrl+enter)
* настройка вида текста (шрифта) во время работы по сочетаниям клавиш:
   ctrl+left/right - уменьшение/увеличение шрифта поля ввода
   shift+left/right - уменьшение/увеличение шрифта текста в истории команд
* регулирование прозрачности консоли по ctrl+up/down (только Windows XP)
* shift+up - изменение цветовой гаммы
* F2 - появление консоли либо снизу либо сверху
* вывод подсказки управления консолью по F1
* малый размер программы ~ 29 Кб
* поддержка плагинов для расширения функциональности

Цель данной разработки создать приложение наиболее малого размера, но с максимальной и НУЖНОЙ функциональностью

* оптимизация
+ добавление
- удаление

14:58 03.10.2005
* защита от запуска нескольких консолей одновременно: заменил атом мьютексом,
т.к. при аварийном завершении проги (килл из диспетчера задач например) атом оставался,
и повторный запуск программы был не возможен вообще :)
мьютекс в отличие от атома зависит от программы и автоматически удаляется при завершении программы
было:
atom := GlobalAddAtom(atomtext);//устанавливаем атом

GlobalDeleteAtom(atom);    //убиваем атом

//если атом не установлен то запуск программы
if GlobalFindAtom(atomtext) = 0 then

стало:
mutex := CreateMutex(nil,true,mutextext);//устанавливаем мьютекс

ReleaseMutex(mutex);//хотя не обязательно убивать мьютекс

//если мьютекс не установлен то запуск программы
if OpenMutex(MUTEX_ALL_ACCESS,false,mutextext) = 0 then

Кстати, в Process Explorer v9.25 тип моего мьютекса=Mutant :)

* для компиляции более быстрого кода, в case установил все значения по возрастающей

+ если консоль становиться неактивной (и раскрыта до конца, а не в процессе "выезжания") то она сворачивается:
 WM_ACTIVATE:
  if ((wParam shl 16)=WA_INACTIVE)and(value>=MaxSize)		then OnShowWindow;

+ изменение прозрачности консоли:
ctrl+up - непрозрачней
ctrl+down - прозрачнее

* теперь консоль не закрывается по Alt+F4

20:03 04.10.2005
+ (экспериментально) история команд выводимая на экран

21:59 07.10.2005
+ экспериментально добавлен вывод строк из КОНСОЛЬНЫХ ПРИЛОЖЕНИЙ, например команда (интерпретатор команд) CMD:
Microsoft Windows XP [Версия 5.1.2600]
(С) Корпорация Майкрософт, 1985-2001.

D:\Documents and Settings\VirEx>
но команда (программа) calc заставляет виснуть приложение на функции ReadFile

22:53 22.10.2005
* изменена прорисовка градиента (раньше прорисовывалась brush'ем (и всё тормозила функция FillRect) а теперь pen'ом (MoveToEx и LineTo))
теперь прорисовка консоли намного быстрей

13:37 23.10.2005
+ автоввод :)
- вывод строк из КОНСОЛЬНЫХ ПРИЛОЖЕНИЙ

22:37 24.10.2005
* механизм прорисовки градиента

* переделан механизм масштабирования консоли при разных разрешениях экрана
(можно запустить например консоль в разрешении 800x600 и поменяв разрешение экрана на 1024x768 вызвать консоль и она отобразиться правильно)

* механизм вывода на экран хистори - теперь количество строк зависит от ширины консоли, а следовательно и от выставленного разрешения экрана (монитора)
(за вывод текста на экран отвечает функция DrawText поэтому тут нужен расчёт)

+ ctrl+left/right уменьшение/увеличение шрифта в поле ввода

+ F1 - вывод помощи в консоли

* изменил запуск программы, раньше:
result:=(31<ShellExecute(0,'open',command,nil,nil,1));
а сейчас через CreateProcess
(теперь работают команды с параметрами, типа "ipconfig /all")

20:07 25.10.2005
+ по просьбам трудящихся добавлен вывод строк из КОНСОЛЬНЫХ ПРИЛОЖЕНИЙ

19:34 31.10.2005
наконец-то есть время для программинга :)
подкорректированы некоторые недочеты с выводом на экран...

- убран надоедающий звук при запуске команды/программы

* полноценная консоль CMD по ctrl+enter (только XP)
всё как в стандартной консоли: dir, cd, ver и т.п.
теперь запускаются все прогаммы в этом режиме, даже вредный calc

* вывод на экран хистори

+ shift+left/right уменьшение/увеличение шрифта в хистори

23:21 02.11.2005
+ изменение цветовой гаммы по shift+up
если недолго держать это сочетание клавиш то консоль меняет цвет по типу радуги постепенно

+ теперь консоль будет выезжать либо сверху, либо снизу, нужно только нажать F2 :)

* опять же Process Explorer v9.25 помог найти баг: в процессе изменения шрифта открывалось много дескрипторов объекта-шрифта (в PE видны как GDI handles),
теперь консоль бережёт опер память, не мусорит :)

23:14 07.11.2005
+ сохранение и чтение всех настроек через XML файл, назвал его незамысловато: WinConsulOptions.xml
при запуске консоли если нет файла настроек всё работает по умолчанию (все настройки), при завершении работы создается этот файлик (перезаписывает все настройки)
настройки которые нельзя изменить в консоли можно подредактировать в этом файле:
AboutF1 - помощь по F1
ConsoleIsUp - появление консоли сверху (true) либо снизу (false)
speed - скорость появления консоли
transparency - прозрачность
divider - делитель, вообщем часть монитора которую будет занимать консоль, чем меньше тем больше консоль занимает места
HistoryLinesCout - количество строк в хистори
HistoryEditCout - количество запоминаемых команд в автовводе

23:50 09.11.2005
+ использование истории Explorer'а (новый модуль UseIERunHistory.pas):
все команды которые запомнились проводником в пуск-выполнить теперь доступны и в консоли
консоль также сохраняет удачные (запустившиеся) команды в историю проводника
эту опцию можно отключить вписав в файл настройки (WinConsulOptions.xml) значение False в секцию UseIEHistory

16:59 13.11.2005
Из-за новой опции сохранения в XML файле от [23:14 07.11.2005] вес программки стал около 100 Кб, что неприемлимо :)
добавление функциональности программе в дальнейшем - это увеличение ёе веса что ооочень плохо, поэтому пришлось за двое суток
спроектировать поддержку плагинов (именно спроектировать а не написать, первое в этом деле - идея и проектирование, а затем уже и реализация, иначе из-за вероятных ошибок
подравка кода съест кучу времени)
теперь WinConsul около 30 Кб и надеюсь больше не будет толстеть :)
+++ поддержка плагинов :)
+ новый плагин Saver/Loader options - сохраняет все настройки в XML файле  WinConsulOptions.xml
+ новый плагин Skin image - позволяет вместо градиента выводить картинку в формате JPG :)
+ полчасика и новый плагин AliasManager - в файле Aliases.txt должны содержаться команды типа (пример):
compAdmin "D:\WINXP\system32\compmgmt.msc"
google "http://www.google.ru"
compAdmin и google это команды а в кавычках исполняемая строка

17:05 15.11.2005
+ новый плагин GetWeather, грузит с Weather.com погоду (файл RSS) и выводит в консоли

23:53 16.11.2005
+ shift+down - изменение цвета хистори по схеме радуги, т.е. как изменение цветовой схемы (shift+up): если подольше подержать сочетание клавиш,
то цвет будет изменяться "по радуге"

2:30 22.11.2005
+ новый плагин Stars - вместо статической картинки или градиента отображает космическое пространство со звездами и в движении,
будто ты летишь в космическом корабле :)
вывод хистори (истории вводимых команд) не работает, только анимация
этот плагин съдает немного процессорного времени (напрягает процессор), поэтому не рекомендуется на слабых машинах
не использует ни DirectX не OpenGL (поэтому требователен к ресурсам процессора)